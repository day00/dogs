<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ESA Puppy Scoring Tool</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
            background-color: #f5f5f5;
            font-size: 16px;
            -webkit-text-size-adjust: 100%;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .save-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #4CAF50;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }
        
        .save-indicator.show {
            opacity: 1;
        }
        
        .instructions {
            background-color: #e8f4f8;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .instructions h2 {
            margin-top: 0;
            font-size: 20px;
        }
        
        .instructions p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        .puppy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 100px;
        }
        
        @media (max-width: 768px) {
            .puppy-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }
        
        .puppy-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .puppy-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .puppy-name-section {
            flex: 1;
            min-width: 200px;
        }
        
        .puppy-name {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
            margin: 0;
            display: inline-block;
        }
        
        .puppy-breed {
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 3px;
        }
        
        .esa-score-badge {
            background: #1976d2;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .esa-score-badge.exceptional {
            background: #4CAF50;
        }
        
        .esa-score-badge.strong {
            background: #2196F3;
        }
        
        .esa-score-badge.moderate {
            background: #FF9800;
        }
        
        .puppy-price {
            font-size: 18px;
            color: #27ae60;
            font-weight: bold;
        }
        
        .special-badges {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }
        
        .badge {
            font-size: 20px;
        }
        
        .puppy-details {
            margin: 10px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        
        .detail-label {
            font-weight: bold;
            color: #555;
        }
        
        .esa-qualities {
            margin: 10px 0;
            padding: 10px;
            background-color: #e8f5e9;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        
        .esa-qualities h4 {
            margin: 0 0 8px 0;
            color: #2e7d32;
            font-size: 16px;
        }
        
        .esa-qualities ul {
            margin: 0;
            padding-left: 20px;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .esa-qualities li {
            margin: 3px 0;
        }
        
        .key-evidence {
            margin: 10px 0;
            padding: 10px;
            background-color: #fff3cd;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }
        
        .key-evidence h4 {
            margin: 0 0 5px 0;
            color: #856404;
            font-size: 16px;
        }
        
        .key-evidence p {
            margin: 0;
            font-size: 14px;
            line-height: 1.4;
            font-style: italic;
        }
        
        .analysis-quality {
            margin: 10px 0;
            padding: 8px;
            background-color: #f0f0f0;
            border-radius: 6px;
            font-size: 13px;
            color: #666;
        }
        
        .scoring-section {
            margin-top: 15px;
            padding: 15px;
            background-color: #e3f2fd;
            border-radius: 8px;
        }
        
        .scoring-section h4 {
            margin: 0 0 10px 0;
            font-size: 16px;
        }
        
        .score-slider {
            width: 100%;
            height: 40px;
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            cursor: pointer;
        }
        
        .score-slider::-webkit-slider-track {
            background: #ddd;
            height: 8px;
            border-radius: 4px;
        }
        
        .score-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 30px;
            height: 30px;
            background: #1976d2;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .score-slider::-moz-range-track {
            background: #ddd;
            height: 8px;
            border-radius: 4px;
        }
        
        .score-slider::-moz-range-thumb {
            width: 30px;
            height: 30px;
            background: #1976d2;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
        
        .score-display {
            font-size: 36px;
            font-weight: bold;
            color: #1976d2;
            text-align: center;
            margin: 10px 0;
        }
        
        .notes-section {
            margin-top: 15px;
        }
        
        .notes-section h4 {
            margin: 0 0 8px 0;
            font-size: 16px;
        }
        
        .notes-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
            font-size: 14px;
        }
        
        .link-button {
            display: inline-block;
            margin-top: 10px;
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-size: 14px;
            text-align: center;
        }
        
        .export-section {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .export-button {
            padding: 12px 20px;
            font-size: 14px;
            font-weight: bold;
            color: white;
            background-color: #27ae60;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            touch-action: manipulation;
        }
        
        .export-button:active {
            background-color: #229954;
            transform: scale(0.98);
        }
        
        .reset-button {
            background-color: #e74c3c;
        }
        
        .reset-button:active {
            background-color: #c0392b;
        }
        
        .sort-section {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .sort-button {
            padding: 8px 16px;
            background-color: #ecf0f1;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            touch-action: manipulation;
        }
        
        .sort-button.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .puppy-name {
                font-size: 18px;
            }
            
            .puppy-price {
                font-size: 16px;
            }
            
            .export-button {
                font-size: 12px;
                padding: 10px 15px;
            }
        }
        
        @media print {
            .export-section, .sort-section, .scoring-section, .notes-section, .save-indicator {
                display: none !important;
            }
            .puppy-card {
                break-inside: avoid;
                margin-bottom: 20px;
            }
            body {
                background: white;
            }
        }
        
        .summary-only {
            display: none;
        }
        
        @media print {
            .summary-only {
                display: block !important;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: white;
                padding: 20px;
                z-index: 9999;
            }
            .puppy-grid, h1, .instructions {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="save-indicator" id="saveIndicator">‚úì Saved</div>
    
    <h1>üêï ESA Puppy Scoring Tool</h1>
    
    <div class="instructions">
        <h2>Find Your Perfect Emotional Support Dog</h2>
        <p>Dogs are pre-scored by ESA qualities. Rate each based on your personal connection!</p>
        <p>‚≠ê‚≠ê‚≠ê = Exceptional ESA (10-12) | ‚≠ê‚≠ê = Strong ESA (7-9) | ‚≠ê = Potential ESA (4-6)</p>
    </div>
    
    <div class="sort-section">
        <button class="sort-button active" onclick="sortPuppies('esa')">By ESA Score</button>
        <button class="sort-button" onclick="sortPuppies('score')">By Your Score</button>
        <button class="sort-button" onclick="sortPuppies('price')">By Price</button>
        <button class="sort-button" onclick="sortPuppies('size')">By Size</button>
    </div>
    
    <div class="puppy-grid" id="puppyGrid">
        <!-- Puppy cards will be inserted here -->
    </div>
    
    <div class="export-section">
        <button class="export-button" onclick="exportToPDF()">üìÑ Export PDF</button>
        <button class="export-button" onclick="exportToCSV()">üìä Export Excel</button>
        <button class="export-button reset-button" onclick="resetScores()">üîÑ Reset All</button>
    </div>
    
    <div class="summary-only" id="printSummary"></div>

    <script>
        // Helper function to translate C2C to human readable
        function getESAQualities(c2cPattern) {
            const qualities = [];
            if (c2cPattern.includes('[‚ü°]')) qualities.push('Active therapy - brightens your day');
            if (c2cPattern.includes('[‚Äª]')) qualities.push('Deep loyalty & devotion');
            if (c2cPattern.includes('[‚ü≥]')) qualities.push('Daily consistency & reliability');
            if (c2cPattern.includes('[‚Üí]')) qualities.push('Shadow dog - stays by your side');
            if (c2cPattern.includes('[‚à∞]')) qualities.push('Physical comfort & cuddles');
            if (c2cPattern.includes('[‚äô]')) qualities.push('Calm, peaceful presence');
            if (c2cPattern.includes('[‚óä]')) qualities.push('Note: Some behaviors are conditional');
            if (c2cPattern.includes('[‚ö°]')) qualities.push('Warning: High energy levels');
            return qualities;
        }
        
        // Extract evidence phrases from description
        function extractEvidence(keyTraits) {
            const patterns = {
                devoted: /devoted/gi,
                loyal: /loyal/gi,
                everyday: /every\s*(single\s*)?day/gi,
                always: /always/gi,
                brighten: /brighten/gi,
                cuddle: /cuddl(e|ing|es|y)/gi,
                snuggle: /snuggl(e|ing|es|y)/gi,
                calm: /calm/gi,
                quiet: /quiet/gi,
                peaceful: /peaceful/gi,
                byside: /by\s*(your\s*)?side/gi,
                shadow: /shadow/gi,
                world: /whole world|my world|your world/gi
            };
            
            const found = [];
            for (const [key, pattern] of Object.entries(patterns)) {
                const matches = keyTraits.match(pattern);
                if (matches) {
                    matches.forEach(match => found.push(`"${match}"`));
                }
            }
            return [...new Set(found)].join(', ');
        }
        
        // Get sufficiency indicator
        function getSufficiency(traits) {
            const count = (traits.match(/\[.*?\]/g) || []).length;
            if (count === 0) return '‚óØ Insufficient data';
            if (count <= 2) return '‚óê Minimal (1-2 traits)';
            if (count <= 4) return '‚óë Moderate (3-4 traits)';
            if (count <= 6) return '‚óí Good (5-6 traits)';
            return '‚óì Rich (7+ traits)';
        }
        
        // Get ESA badge info
        function getESABadge(score) {
            if (score >= 10) return { class: 'exceptional', stars: '‚≠ê‚≠ê‚≠ê' };
            if (score >= 7) return { class: 'strong', stars: '‚≠ê‚≠ê' };
            if (score >= 4) return { class: 'moderate', stars: '‚≠ê' };
            return null;
        }
        
        // Get special badges
        function getSpecialBadges(name, keyTraits, esaScore) {
            const badges = [];
            if (['Hope', 'Gabby', 'Lacey'].includes(name)) badges.push('üèÜ');
            if (keyTraits.toLowerCase().includes('whole world')) badges.push('üíõ');
            if (keyTraits.toLowerCase().includes('pre-trained') || keyTraits.toLowerCase().includes('trained')) badges.push('üéì');
            if (name === 'Gabby') badges.push('‚ú®');
            return badges;
        }

        // Puppy data - only including dogs with ESA score 4+
        const puppies = [
            {
                name: "Hope",
                breed: "Bernedoodle",
                price: 2800,
                weight: "67-87 lbs",
                location: "Gray Court, SC",
                keyTraits: "Brighten your day, always wagging, spreading good vibes. Gentle cuddle buddy. Devoted, shows love every single day.",
                c2cPattern: "[‚ü°][‚ü≥][‚Äª][‚à∞]",
                c2cMeaning: "Active daily emotional support with deep bond",
                link: "https://www.bestbernedoodles.com/bernedoodle-puppies/",
                esaScore: 12,
                website: "BestBernedoodles"
            },
            {
                name: "Gabby",
                breed: "Sheepadoodle",
                price: 2100,
                weight: "12-24 lbs",
                location: "Greenville, SC",
                keyTraits: "Affectionate, always looking for cuddles and belly rubs. Loyal, always by your side, ready to brighten your day.",
                c2cPattern: "[‚ü≥][‚Äª][‚Üí][‚ü°][‚à∞]",
                c2cMeaning: "Complete ESA package with active therapy",
                link: "https://www.crockettdoodles.com/puppy/available/14fck5c-sheepadoodle-gabby/",
                esaScore: 12,
                website: "Crockett Doodles"
            },
            {
                name: "Lacey",
                breed: "Saint Berdoodle",
                price: 2300,
                weight: "16-30 lbs",
                location: "Greenville, SC",
                keyTraits: "Gentle soul, calm demeanor, thoughtful personality. Loyal heart. Loves curling up for nap by your side.",
                c2cPattern: "[‚Äª][‚à∞][‚äô][‚Üí]",
                c2cMeaning: "Inherently calm with physical closeness",
                link: "https://www.crockettdoodles.com/puppy/available/14hj7y8-saint-berdoodle-lacey/",
                esaScore: 10,
                website: "Crockett Doodles"
            },
            {
                name: "Zenith",
                breed: "Golden Sheepadoodle",
                price: "Contact for price",
                weight: "22-38 lbs",
                location: "Taylor's, SC",
                keyTraits: "Pre-trained, laid-back, quiet personality, tunes into humans. Dialed in for connection, soulful eyes, loves being with people.",
                c2cPattern: "[‚Äª][‚äô][‚Üí]",
                c2cMeaning: "Human-attuned with training bonus",
                link: "https://www.crockettdoodles.com/puppy/available/14cyvi8-sheepadoodle-zenith/",
                esaScore: 10,
                website: "Crockett Doodles"
            },
            {
                name: "Bernadette",
                breed: "Bernedoodle",
                price: 2700,
                weight: "73-93 lbs",
                location: "Greenville, SC",
                keyTraits: "Gentle, careful and kind, loves curling up beside you for quiet snuggles",
                c2cPattern: "[‚à∞][‚Üí][‚äô]",
                c2cMeaning: "Strong physical comfort with calm presence",
                link: "https://www.crockettdoodles.com/puppy/available/14ehnnk-bernedoodle-bernadette/",
                esaScore: 9,
                website: "Crockett Doodles"
            },
            {
                name: "Blanche",
                breed: "Bernedoodle",
                price: 2700,
                weight: "73-93 lbs",
                location: "Greenville, SC",
                keyTraits: "Calm presence, loyal, stays close to favorite humans",
                c2cPattern: "[‚Äª][‚äô][‚Üí]",
                c2cMeaning: "Excellent shadow behavior with inherent calm",
                link: "https://www.crockettdoodles.com/puppy/available/14ekgsg-bernedoodle-blanche/",
                esaScore: 9,
                website: "Crockett Doodles"
            },
            {
                name: "Kimber",
                breed: "Golden Sheepadoodle",
                price: "Contact for price",
                weight: "22-38 lbs",
                location: "Taylors, SC",
                keyTraits: "Pre-trained, gentle, peaceful vibe, never want to put down",
                c2cPattern: "[‚à∞‚à∞][‚äô]",
                c2cMeaning: "Extreme physical bonding with training",
                link: "https://www.crockettdoodles.com/puppy/available/14cxgxs-sheepadoodle-kimber/",
                esaScore: 9,
                website: "Crockett Doodles"
            },
            {
                name: "Jasmine",
                breed: "Aussiedoodle",
                price: 2200,
                weight: "18-30 lbs",
                location: "Greer, SC",
                keyTraits: "Gentle, always ready to sit quietly by your side and soak up love. Calm demeanor. Intelligent, quick to learn. Playful when time for ball.",
                c2cPattern: "[‚à∞][‚äô][‚Üí][‚óä]",
                c2cMeaning: "Rare calm Aussiedoodle with shadow behavior",
                link: "https://www.crockettdoodles.com/puppy/available/14ga9s0-aussiedoodle-jasmine/",
                esaScore: 8,
                website: "Crockett Doodles"
            },
            {
                name: "Sundae",
                breed: "Bernedoodle",
                price: 2500,
                weight: "68-88 lbs",
                location: "Greenville, SC",
                keyTraits: "Sweet little Bernedoodle girl who's just as delightful as my name! Playful antics will have you smiling, and my snuggles will warm your heart. Always ready to brighten your day.",
                c2cPattern: "[‚ü≥][‚ü°][‚à∞]",
                c2cMeaning: "Active therapy trait like Hope",
                link: "https://www.bestbernedoodles.com/bernedoodle-puppies/",
                esaScore: 8,
                website: "BestBernedoodles"
            },
            {
                name: "Gracie",
                breed: "Sheepadoodle",
                price: 2000,
                weight: "12-24 lbs",
                location: "Greenville, SC",
                keyTraits: "Sweet loving nature, obedient, devoted, you're her whole world",
                c2cPattern: "[‚Äª‚Äª]",
                c2cMeaning: "Extreme devotion - rare intensity",
                link: "https://www.crockettdoodles.com/puppy/available/14fb5kw-sheepadoodle-gracie/",
                esaScore: 8,
                website: "Crockett Doodles"
            },
            {
                name: "Amara",
                breed: "Bernedoodle",
                price: 2600,
                weight: "71-81 lbs",
                location: "Easley, SC",
                keyTraits: "Affectionate, belly rubs and snuggles. Calm, relax by your side while you read or watch TV. Spirited when play time.",
                c2cPattern: "[‚à∞‚à∞][‚äô][‚Üí][‚óä][‚ö°]",
                c2cMeaning: "Physical comfort & calm presence but conditional energy",
                link: "https://www.crockettdoodles.com/puppy/available/14e7tog-bernedoodle-amara/",
                esaScore: 5,
                website: "Crockett Doodles"
            },
            {
                name: "Cindy",
                breed: "Bernedoodle",
                price: 2800,
                weight: "59-79 lbs",
                location: "Greer, SC",
                keyTraits: "Gentle, loves to sit quietly by your side and soak up all the love. But don't think I'm shy‚ÄîI'm also outgoing, always wagging my tail. When it's time to play, I'm spirited.",
                c2cPattern: "[‚à∞][‚Üí][‚ö°][‚óä]",
                c2cMeaning: "Good shadow behavior but energy concerns",
                link: "https://www.crockettdoodles.com/puppy/available/14h6ku8-bernedoodle-cindy/",
                esaScore: 5,
                website: "Crockett Doodles"
            },
            {
                name: "Audrey",
                breed: "Aussiedoodle",
                price: 2200,
                weight: "16-30 lbs",
                location: "Greenville, SC",
                keyTraits: "Graceful, affectionate, and intelligent, always eager to learn new tricks or snuggle up for a quiet moment.",
                c2cPattern: "[‚à∞][‚äô]",
                c2cMeaning: "Another rare calm Aussiedoodle",
                link: "https://www.crockettdoodles.com/puppy/available/14afklc-aussiedoodle-audrey/",
                esaScore: 5,
                website: "Crockett Doodles"
            },
            {
                name: "Beatrice",
                breed: "Bernedoodle",
                price: 2600,
                weight: "73-93 lbs",
                location: "Greenville, SC",
                keyTraits: "Intelligent, picking up new tricks quickly. Calm, happy to sit by your side. When it's time to play, I'm spirited.",
                c2cPattern: "[‚äô][‚Üí][‚ö°][‚óä]",
                c2cMeaning: "Calm shadow dog but conditional energy",
                link: "https://www.crockettdoodles.com/puppy/available/14ej280-bernedoodle-beatrice/",
                esaScore: 6,
                website: "Crockett Doodles"
            },
            {
                name: "Aria",
                breed: "Bernedoodle",
                price: 2700,
                weight: "71-81 lbs",
                location: "Easley, SC",
                keyTraits: "Sweet Bernedoodle girl who loves bringing smiles! Playful, smart, and a total cuddle bug, always ready for fun or cozy nap by your side.",
                c2cPattern: "[‚à∞][‚Üí][‚ö°]",
                c2cMeaning: "Cuddle bug with shadow behavior but playful",
                link: "https://www.crockettdoodles.com/puppy/available/14e50jk-bernedoodle-aria/",
                esaScore: 6,
                website: "Crockett Doodles"
            },
            {
                name: "Astra",
                breed: "Bernedoodle",
                price: 2500,
                weight: "71-81 lbs",
                location: "Easley, SC",
                keyTraits: "Adventurous, always ready to explore. Gentle, making me the perfect cuddle buddy after a long day of play.",
                c2cPattern: "[‚à∞][‚óä]",
                c2cMeaning: "Conditional cuddles after activity",
                link: "https://www.crockettdoodles.com/puppy/available/14e6f40-bernedoodle-astra/",
                esaScore: 4,
                website: "Crockett Doodles"
            },
            {
                name: "Aubrie",
                breed: "Bernedoodle",
                price: 2700,
                weight: "71-81 lbs",
                location: "Easley, SC",
                keyTraits: "Bouncy, wagging tail never stops. Playful but loyal, sticking by your side like shadow.",
                c2cPattern: "[‚Äª][‚Üí][‚óä][‚ö°]",
                c2cMeaning: "True shadow dog with devoted bond but high energy",
                link: "https://www.crockettdoodles.com/puppy/available/14e988w-bernedoodle-aubrie/",
                esaScore: 4,
                website: "Crockett Doodles"
            },
            {
                name: "Tikka",
                breed: "Golden Sheepadoodle",
                price: "Contact for price",
                weight: "22-38 lbs",
                location: "Taylor's, SC",
                keyTraits: "Pre-trained. Spunky, full of sass, but also curling up in lap for snuggles. Fits perfectly into your heart.",
                c2cPattern: "[‚Äª][‚à∞][‚ö°]",
                c2cMeaning: "Heart connection with cuddles but spunky",
                link: "https://www.crockettdoodles.com/puppy/available/14d0a2o-sheepadoodle-tikka/",
                esaScore: 4,
                website: "Crockett Doodles"
            },
            {
                name: "Pocahontas",
                breed: "Swiss Doodle",
                price: 2000,
                weight: "25-40 lbs",
                location: "Travelers Rest, SC",
                keyTraits: "Calm and gentle pup, but loves when it's playtime‚ÄîI'll happily chase a ball.",
                c2cPattern: "[‚äô][‚óä]",
                c2cMeaning: "Calm but conditional on activity level",
                link: "https://www.crockettdoodles.com/puppy/available/14d5wcg-swiss-doodle-pocahontas/",
                esaScore: 4,
                website: "Crockett Doodles"
            }
        ];
        
        // Initialize or load saved data
        function loadSavedData() {
            const saved = localStorage.getItem('puppyScores');
            if (saved) {
                const savedData = JSON.parse(saved);
                puppies.forEach((puppy, index) => {
                    puppy.id = index;
                    const savedPuppy = savedData.find(p => p.name === puppy.name);
                    if (savedPuppy) {
                        puppy.score = savedPuppy.score || 5;
                        puppy.notes = savedPuppy.notes || "";
                    } else {
                        puppy.score = 5;
                        puppy.notes = "";
                    }
                });
            } else {
                puppies.forEach((puppy, index) => {
                    puppy.id = index;
                    puppy.score = 5;
                    puppy.notes = "";
                });
            }
        }
        
        // Save data
        function saveData() {
            const dataToSave = puppies.map(p => ({
                name: p.name,
                score: p.score,
                notes: p.notes
            }));
            localStorage.setItem('puppyScores', JSON.stringify(dataToSave));
            
            // Show save indicator
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 1500);
        }
        
        // Render puppy cards
        function renderPuppies() {
            const grid = document.getElementById('puppyGrid');
            grid.innerHTML = '';
            
            puppies.forEach(puppy => {
                const card = document.createElement('div');
                card.className = 'puppy-card';
                
                const badge = getESABadge(puppy.esaScore);
                const specialBadges = getSpecialBadges(puppy.name, puppy.keyTraits, puppy.esaScore);
                const esaQualities = getESAQualities(puppy.c2cPattern);
                const evidence = extractEvidence(puppy.keyTraits);
                const sufficiency = getSufficiency(puppy.c2cPattern);
                
                card.innerHTML = `
                    <div class="puppy-header">
                        <div class="puppy-name-section">
                            <h3 class="puppy-name">${puppy.name}</h3>
                            <span class="puppy-breed">(${puppy.breed})</span>
                            ${specialBadges.length > 0 ? `<div class="special-badges">${specialBadges.map(b => `<span class="badge">${b}</span>`).join('')}</div>` : ''}
                        </div>
                        ${badge ? `<div class="esa-score-badge ${badge.class}">ESA: ${puppy.esaScore} ${badge.stars}</div>` : ''}
                        <div class="puppy-price">${typeof puppy.price === 'number' ? '$' + puppy.price : puppy.price}</div>
                    </div>
                    
                    <div class="puppy-details">
                        <div class="detail-row">
                            <span class="detail-label">Weight:</span>
                            <span>${puppy.weight}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Location:</span>
                            <span>${puppy.location}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Website:</span>
                            <span>${puppy.website || 'Crockett Doodles'}</span>
                        </div>
                    </div>
                    
                    ${esaQualities.length > 0 ? `
                    <div class="esa-qualities">
                        <h4>ESA Qualities:</h4>
                        <ul>
                            ${esaQualities.map(q => `<li>${q}</li>`).join('')}
                        </ul>
                    </div>
                    ` : ''}
                    
                    ${evidence ? `
                    <div class="key-evidence">
                        <h4>Key Evidence:</h4>
                        <p>${evidence}</p>
                    </div>
                    ` : ''}
                    
                    <div class="analysis-quality">
                        <strong>Analysis Quality:</strong> ${sufficiency}
                    </div>
                    
                    <a href="${puppy.link}" target="_blank" class="link-button">View Full Profile</a>
                    
                    <div class="scoring-section">
                        <h4>Your Score:</h4>
                        <input type="range" class="score-slider" min="0" max="10" value="${puppy.score}" 
                               oninput="updateScore(${puppy.id}, this.value)">
                        <div class="score-display" id="score-${puppy.id}">${puppy.score}</div>
                    </div>
                    
                    <div class="notes-section">
                        <h4>Your Notes:</h4>
                        <textarea class="notes-input" placeholder="What behaviors do you see? Did she show calm behavior? Any concerns?"
                                  onblur="updateNotes(${puppy.id}, this.value)">${puppy.notes}</textarea>
                    </div>
                `;
                grid.appendChild(card);
            });
        }
        
        // Update score
        function updateScore(id, score) {
            puppies[id].score = parseInt(score);
            document.getElementById(`score-${id}`).textContent = score;
            saveData();
        }
        
        // Update notes
        function updateNotes(id, notes) {
            puppies[id].notes = notes;
            saveData();
        }
        
        // Reset all scores
        function resetScores() {
            if (confirm('Are you sure you want to reset all scores and notes?')) {
                puppies.forEach(puppy => {
                    puppy.score = 5;
                    puppy.notes = "";
                });
                saveData();
                renderPuppies();
            }
        }
        
        // Sort puppies
        function sortPuppies(method) {
            document.querySelectorAll('.sort-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            switch(method) {
                case 'esa':
                    puppies.sort((a, b) => b.esaScore - a.esaScore);
                    break;
                case 'score':
                    puppies.sort((a, b) => b.score - a.score);
                    break;
                case 'price':
                    puppies.sort((a, b) => {
                        const priceA = typeof a.price === 'number' ? a.price : 999999;
                        const priceB = typeof b.price === 'number' ? b.price : 999999;
                        return priceA - priceB;
                    });
                    break;
                case 'size':
                    puppies.sort((a, b) => {
                        const sizeA = parseInt(a.weight.split('-')[0]);
                        const sizeB = parseInt(b.weight.split('-')[0]);
                        return sizeA - sizeB;
                    });
                    break;
            }
            renderPuppies();
        }
        
        // Export to PDF (print)
        function exportToPDF() {
            const summary = document.getElementById('printSummary');
            const sortedPuppies = [...puppies].sort((a, b) => b.score - a.score);
            
            let html = `
                <h1>My ESA Puppy Rankings</h1>
                <p style="text-align: center; color: #666;">Generated on ${new Date().toLocaleDateString()}</p>
                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <thead>
                        <tr style="background-color: #f4f4f4;">
                            <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Rank</th>
                            <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Puppy</th>
                            <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">ESA/Your Score</th>
                            <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Details</th>
                            <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Notes</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            sortedPuppies.forEach((puppy, index) => {
                const price = typeof puppy.price === 'number' ? '$' + puppy.price : puppy.price;
                html += `
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">#${index + 1}</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">
                            <strong>${puppy.name}</strong><br>
                            <small>${puppy.breed}</small>
                        </td>
                        <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">
                            ESA: ${puppy.esaScore}<br>
                            You: ${puppy.score}/10
                        </td>
                        <td style="padding: 10px; border: 1px solid #ddd;">
                            <strong>Price:</strong> ${price}<br>
                            <strong>Weight:</strong> ${puppy.weight}<br>
                            <strong>Location:</strong> ${puppy.location}<br>
                            <strong>Key Traits:</strong> ${puppy.keyTraits}
                        </td>
                        <td style="padding: 10px; border: 1px solid #ddd;">${puppy.notes || 'No notes'}</td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
                <div style="margin-top: 30px;">
                    <h3>Top 3 Choices:</h3>
                    <ol>
            `;
            
            sortedPuppies.slice(0, 3).forEach(puppy => {
                html += `<li><strong>${puppy.name}</strong> (${puppy.breed}) - Your Score: ${puppy.score}/10, ESA: ${puppy.esaScore}<br>
                         Link: ${puppy.link}</li>`;
            });
            
            html += `
                    </ol>
                </div>
            `;
            
            summary.innerHTML = html;
            window.print();
            setTimeout(() => { summary.innerHTML = ''; }, 100);
        }
        
        // Export to CSV
        function exportToCSV() {
            const sortedPuppies = [...puppies].sort((a, b) => b.score - a.score);
            
            let csv = 'Rank,Name,Breed,Your Score,ESA Score,Price,Weight,Location,ESA Qualities,Notes,Link\n';
            
            sortedPuppies.forEach((puppy, index) => {
                const price = typeof puppy.price === 'number' ? puppy.price : '"' + puppy.price + '"';
                const notes = puppy.notes ? '"' + puppy.notes.replace(/"/g, '""') + '"' : '';
                const qualities = '"' + puppy.c2cMeaning.replace(/"/g, '""') + '"';
                
                csv += `${index + 1},${puppy.name},${puppy.breed},${puppy.score},${puppy.esaScore},${price},"${puppy.weight}","${puppy.location}",${qualities},${notes},"${puppy.link}"\n`;
            });
            
            // Create download
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'esa_puppy_rankings_' + new Date().toISOString().split('T')[0] + '.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }
        
        // Initialize with ESA sort
        loadSavedData();
        puppies.sort((a, b) => b.esaScore - a.esaScore);
        renderPuppies();
    </script>
</body>
</html>
